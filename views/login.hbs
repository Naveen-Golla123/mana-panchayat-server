<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- <meta name="color-scheme" content="dark light"> -->

    <title>Mana Panchayat | Login</title>

    <!-- Local CSS Link -->
    <link rel="stylesheet" href="./css/style.css">

    <!-- Bootstrap Links -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <!-- Fontawesome Link -->
    <script src="https://kit.fontawesome.com/1a2b0738bb.js" crossorigin="anonymous"></script>

</head>

<body>

    <div class="main-container d-flex justify-content-center align-items-center bg-light">

        <!-- Login Form -->
        <div id="loginFormContainer" class="login-container d-non box-container bg-white shadow">
            <div class="row">
                <div class="col-12 p-5">
                    <h3 class="">Login</h3>
                    <hr />
                    <form id="loginForm">
                        <div class="form-group">
                            <div class="d-flex justify-content-between">
                                <label for="loginUsername">Username</label>
                                <span id="loginUsernameErrMsg" class="text-danger text-right"></span>
                            </div>
                            <input type="text" class="form-control" id="loginUsername"
                                placeholder="Enter Your Username">
                        </div>
                        <div class="form-group">
                            <div class="d-flex justify-content-between">
                                <label for="loginPassword">Password</label>
                                <span id="loginPasswordErrMsg" class="text-danger text-right"></span>
                            </div>

                            <input type="password" class="form-control" id="loginPassword"
                                placeholder="Enter New Password">
                        </div>


                        <button id="logInButton" class="btn btn-dark btn-block">Login</button>
                        <div class="text-center mt-3">
                            <label class="form-check-label" for="gridCheck">
                                Not yet signed up? <span id="signupClick" class="text-danger cursor-point"> <a
                                        href="./signup.html">Signup Now</a> </span>
                            </label>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Local Js Link -->
    <script>
        // Login Related Elements
        let loginFormContainerEl = document.getElementById("loginFormContainer");
        let loginFormEl = document.getElementById("loginForm");
        let loginClickEl = document.getElementById("loginClick");
        // Login Input Elements
        let loginUsername = document.getElementById("loginUsername");
        let loginPasswordEl = document.getElementById("loginPassword");
        // Login Error Message
        let loginUsernameErrMsg = document.getElementById("loginMailErrMsg");
        let loginPasswordErrMsgEl = document.getElementById("loginPasswordErrMsg");
        // Login Form Validation
        loginUsername.addEventListener("blur", function (event) {
            if (event.target.value === "") {
                loginUsernameErrMsg.textContent = "Required*";
                loginUsername.classList.add("border-danger");
            } else {
                loginUsernameErrMsg.textContent = "";
                loginUsername.classList.remove("border-danger");
            }
        });

        loginPasswordEl.addEventListener("blur", function (event) {
            if (event.target.value === "") {
                loginPasswordErrMsgEl.textContent = "Required*";
                loginPasswordEl.classList.add("border-danger");
            } else {
                loginPasswordErrMsgEl.textContent = "";
                loginPasswordEl.classList.remove("border-danger");
            }
        });
        // Login Button Submit
        let logInButtonEl = document.getElementById("logInButton");

        // LogIn Onclick Functioning
        logInButtonEl.addEventListener("click", function (event) {

            event.preventDefault();

            //Login (Posting Data & get token)
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
                "username": loginUsername.value,
                "password": loginPasswordEl.value
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("http://localhost:3000/Auth/signIn", requestOptions)
                .then(response => response.json())
                .then(result => {
                    console.log(result)
                    if (result) {
                        if (result["loggedIn"]) {
                            var mainURL = window.location.href;
                            var baseURL = mainURL.substring(0, mainURL.lastIndexOf("/") + 1);
                            var postUrlEl = baseURL + "News/createNews";
                            window.location.href = postUrlEl;
                        }else{
                            // incorrect password
                        }
                    }
                })
                .catch(error => console.log('error', error));
        });

    </script>
</body>

</html>